From 1838aaf4435e7906112b31445dadc87f09b4b2cf Mon Sep 17 00:00:00 2001
From: Yecheng Zhao <zyecheng@google.com>
Date: Mon, 14 Aug 2023 21:52:13 +0000
Subject: [PATCH] rules_rust add uefi support

---
 rust/platform/triple_mappings.bzl | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/rust/platform/triple_mappings.bzl b/rust/platform/triple_mappings.bzl
index 7f6ef2c7..963c99c7 100644
--- a/rust/platform/triple_mappings.bzl
+++ b/rust/platform/triple_mappings.bzl
@@ -95,6 +95,7 @@ _SYSTEM_TO_BUILTIN_SYS_SUFFIX = {
     "none": "none",
     "openbsd": "openbsd",
     "solaris": None,
+    "uefi": "none",
     "unknown": None,
     "wasi": None,
     "windows": "windows",
@@ -111,6 +112,7 @@ _SYSTEM_TO_BINARY_EXT = {
     "ios": "",
     "linux": "",
     "none": "",
+    "uefi": ".efi",
     # This is currently a hack allowing us to have the proper
     # generated extension for the wasm target, similarly to the
     # windows target
@@ -130,6 +132,7 @@ _SYSTEM_TO_STATICLIB_EXT = {
     "ios": ".a",
     "linux": ".a",
     "none": ".a",
+    "uefi": ".a",
     "unknown": "",
     "wasi": "",
     "windows": ".lib",
@@ -146,6 +149,7 @@ _SYSTEM_TO_DYLIB_EXT = {
     "ios": ".dylib",
     "linux": ".so",
     "none": ".so",
+    "uefi": ".so",
     "unknown": ".wasm",
     "wasi": ".wasm",
     "windows": ".dll",
@@ -189,6 +193,7 @@ _SYSTEM_TO_STDLIB_LINKFLAGS = {
     "none": [],
     "openbsd": ["-lpthread"],
     "solaris": ["-lsocket", "-lposix4", "-lpthread", "-lresolv"],
+    "uefi": [],
     "unknown": [],
     "uwp": ["ws2_32.lib"],
     "wasi": [],
-- 
2.41.0.694.ge786442a9b-goog

